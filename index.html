<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <title>Dutch Flashcards</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF9F1C">
    <link rel="icon" href="/flashcards/favicon.ico"> 
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* --- STYLING (Compact Mobile Fix) --- */
        :root {
            --primary: #FF9F1C; --primary-dark: #e08000; --secondary: #2EC4B6;
            --bg-app: #F4F6F8; --bg-card: #FFFFFF; --text-main: #1A1A1A; --text-sub: #788591;
            --color-again: #FF595E; --color-hard: #FFCA3A; --color-good: #8AC926; --color-easy: #1982C4;
            --radius-lg: 20px; --radius-md: 12px;
            --safe-area-top: env(safe-area-inset-top, 0px);
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            -webkit-text-size-adjust: 100%; 
        }

        html { 
            /* 62.5% means 1rem = 10px. This makes math easy and scaling consistent. */
            font-size: 62.5%; 
            height: 100dvh; 
            width: 100%; 
            overflow: hidden; 
        }

        body { 
            margin: 0; 
            padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: var(--bg-app); 
            color: var(--text-main); 
            height: 100%; 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            overscroll-behavior-y: none;
            min-height: -webkit-fill-available;
        }

        /* Screen Visibility */
        .screen { display: none; width: 100%; height: 100dvh; flex-direction: column; background: var(--bg-app); overflow: hidden; }
        .screen.active { display: flex; }

        /* Layout */
        #app-container { display: flex; flex-direction: column; position: relative; overflow: hidden; width: 100%; height: 100%; }
        
        /* Tighter padding for mobile */
        .content-scroll { 
            flex: 1; 
            overflow-y: auto; 
            overflow-x: hidden; 
            padding: 12px; 
            padding-bottom: calc(40px + var(--safe-area-bottom)); 
            display: flex; 
            flex-direction: column; 
            -webkit-overflow-scrolling: touch;
            min-height: 0; 
            overscroll-behavior-y: contain; 
        }
        
        .list-scroll { 
            flex: 1; 
            overflow-y: auto; 
            overflow-x: hidden; 
            padding: 12px; 
            padding-top: 0; 
            padding-bottom: calc(40px + var(--safe-area-bottom)); 
            min-height: 0; 
            -webkit-overflow-scrolling: touch; 
            overscroll-behavior-y: contain;
        }
        
        .fixed-controls { flex-shrink: 0; padding: 12px; background: var(--bg-app); z-index: 10; border-bottom: 1px solid rgba(0,0,0,0.05); }

        /* Compact Header */
        .app-header { 
            height: calc(50px + var(--safe-area-top)); /* Reduced from 100px */
            padding-top: var(--safe-area-top); 
            background: var(--bg-card); 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding-left: 12px; 
            padding-right: 12px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            z-index: 50; 
            flex-shrink: 0; 
        }
        
        .header-title { 
            font-weight: 700; 
            font-size: 2.0rem; /* Drastically reduced from 5rem */
            color: var(--text-main); 
            text-align: center; 
            position: absolute; left: 50%; transform: translateX(-50%); width: 100%; 
            pointer-events: none; 
            white-space: nowrap; 
        }
        
        .btn-icon { background: none; border: none; font-size: 2.4rem; cursor: pointer; padding: 8px; z-index: 2; }
        .btn-text { background: none; border: none; font-size: 1.4rem; font-weight: 600; color: var(--primary); cursor: pointer; z-index: 2; }

        /* Components */
        .container-elevated { background: var(--bg-card); border-radius: var(--radius-lg); box-shadow: 0 4px 12px rgba(0,0,0,0.03); margin-bottom: 12px; padding: 16px; }
        
        /* --- COMPACT PROGRESS WIDGET --- */
        .progress-widget { 
            background: #F8F9FA; 
            border-radius: var(--radius-md); 
            padding: 16px 10px; /* Reduced vertical padding */
            margin-top: 10px; 
            width: 100%; 
        }
        .pw-grid { 
            display: grid; 
            grid-template-columns: max-content 1fr 10px 1fr; 
            align-items: center; 
            row-gap: 5px; 
            column-gap: 5px;
            width: 100%;
        }
        .pw-head { font-size: 1.4rem; font-weight: 700; color: #ADB5BD; text-align: center; line-height: 1; }
        .pw-label { font-size: 1.4rem; font-weight: 600; color: var(--text-sub); text-align: right; padding-right: 15px; white-space: nowrap; }
        .pw-val { font-size: 2.2rem; font-weight: 800; color: var(--primary); text-align: center; line-height: 1; }
        .pw-div-vert { width: 2px; height: 30px; background: #E9ECEF; margin: 0 auto; border-radius: 2px; }

        /* Compact Menu */
        .menu-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            margin-top: 5px; 
        }
        .menu-btn { 
            background: var(--bg-card); 
            border: none; 
            border-radius: var(--radius-lg); 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.04); 
            cursor: pointer; 
            /* Removed fixed aspect ratio to allow shrinking */
            min-height: 130px; 
            width: 100%; 
        }
        .menu-icon { font-size: 5rem; line-height: 1; } /* Reduced from 15rem to 5rem */
        .menu-text { font-weight: 700; font-size: 1.6rem; color: var(--text-main); }

        /* Flashcard Stage */
        .flashcard-stage { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 16px; perspective: 1000px; padding-bottom: 120px; }
        
        .progress-track { width: 100%; max-width: 600px; height: 30px; background: #e0e0e0; border-radius: 15px; margin-bottom: 16px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        .progress-text { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; font-weight: 700; color: var(--text-main); }

        .flashcard { width: 100%; max-width: 600px; aspect-ratio: 4/5; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; }
        .flashcard.flipped { transform: rotateY(180deg); }
        .flashcard.no-transition { transition: none !important; }
        
        /* Face Logic */
        .face { 
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
            border-radius: 20px; background: var(--bg-card); box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            display: flex; flex-direction: column; padding: 20px; border: 1px solid rgba(0,0,0,0.02);
            pointer-events: none; 
            transition: z-index 0s linear 0.3s; 
        }
        .face.back { transform: rotateY(180deg); }

        .flashcard:not(.flipped) .face.front { pointer-events: auto; z-index: 10; }
        .flashcard.flipped .face.back { pointer-events: auto; z-index: 10; }
        .flashcard.flipped .face.front { z-index: 0; }
        .flashcard:not(.flipped) .face.back { z-index: 0; }

        .face-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .lang-flag { font-size: 3rem; }
        .card-status { font-size: 1.2rem; font-weight: 700; padding: 4px 10px; background: #eee; border-radius: 100px; color: #666; }
        .face-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; overflow:hidden; }
        .word-text { font-size: 3.2rem; font-weight: 700; text-align: center; word-break: break-word; line-height: 1.2; }
        .hint-image { max-width: 100%; max-height: 200px; border-radius: 12px; object-fit: contain; background: #f8f8f8; }

        /* Interaction Buttons */
        .tts-btn { position: absolute; bottom: 15px; left: 15px !important; right: auto !important; background: none; border: none; font-size: 2.5rem; cursor: pointer; z-index: 10; }
        .hint-btn { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); background: none; border: none; font-size: 2.5rem; cursor: pointer; z-index: 10; }
        .edit-card-btn { position: absolute; bottom: 15px; right: 15px; background: #eee; border: none; border-radius: 10px; padding: 10px 20px; font-weight: 700; font-size: 1.3rem; cursor: pointer; z-index: 10; }

        /* Rating Controls */
        .review-controls { position: absolute; bottom: 0; left: 0; width: 100%; padding: 15px; padding-bottom: calc(20px + var(--safe-area-bottom)); background: rgba(255,255,255,0.95); border-top: 1px solid #eee; display: flex; gap: 10px; z-index: 100; }
        .rating-btn { flex: 1; border: none; padding: 25px 0; border-radius: 12px; font-weight: 700; color: white; font-size: 1.6rem; cursor: pointer; }
        
        /* Dictionary */
        .search-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .search-input { flex:1; padding: 14px; border: 1px solid #ddd; border-radius: 12px; font-size: 1.6rem; }
        
        /* Dictionary Specific Overrides */
        #screen-wordReview .
